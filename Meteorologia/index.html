<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>SMADSOT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="./lib/jquery.min.js"></script>
    <script src="./lib/chart.min.js"></script>

    <script src="./bootstrap/bootstrap.min.js"></script>
    <script src="./bootstrap/dropdowns/dropdowns-enhancement.js"></script>
    <script src="./bootstrap/datepicker/bootstrap-datepicker.js"></script>
    <script src="./bootstrap/dialog/bootstrap-dialog.js"></script>

    <link rel="stylesheet" href="./bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="./bootstrap/dropdowns/dropdowns-enhancement.css" />
    <link rel="stylesheet" href="./bootstrap/datepicker/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="./bootstrap/dialog/bootstrap-dialog.css" />

    <link rel="stylesheet" href="./css/estilos.css" />
    
    <link rel="stylesheet" href="app.css" />

    <script src="./lib/dom-to-image.js"></script>

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&amp;display=swap" rel="stylesheet" />
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-container">
        <a href="index.html" class="navbar-logo">
          <img src="./images/header/SMADSOTlogo.jpg" alt="Logos" class="navbar-icon" />
        </a>

        <div class="hamburger-menu" onclick="toggleMenu()">
          <div class="bar"></div>
          <div class="bar"></div>
          <div class="bar"></div>
        </div>

        <ul class="nav-links" id="nav-links">
          <li><a onclick="location.reload()">Inicio</a></li>
          <li><a href="https://smadsot.puebla.gob.mx/quienes-somos">Quienes Somos</a></li>
          <li><a href="https://smadsot.puebla.gob.mx/avisos-de-privacidad">Avisos de Privacidad</a></li>
          <li><a href="https://ventanilladigital.puebla.gob.mx/">Trámites</a></li>
          <li><a href="http://transparencia.puebla.gob.mx/">Transparencia</a></li>
          <li><a href="https://smadsot.puebla.gob.mx/verificacion">Verificación</a></li>
          <li class="mobile-only"><a href="#" id="btn_atmos_mobile">Atmósfera</a></li>
          <li class="mobile-only"><a href="#" id="btn_aire_mobile">Calidad del aire</a></li>
          <li class="mobile-only"><a href="#" id="btn_hist_mobile">Historial</a></li>
          <li class="social-icons">
            <a href="https://twitter.com/AmbienteGobPue" target="_blank">
              <img src="./images/twitter.svg" alt="Twitter" />
            </a>
          </li>
          <li class="social-icons">
            <a href="https://www.facebook.com/Medio-Ambiente-Desarrollo-Sustentable-y-Ordenamiento-Territorial-110848296920026/" target="_blank">
              <img src="./images/facebook.svg" alt="Facebook" />
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <section class="banner" id="banner">
      <div class="banner-content">
        <h1 class="banner-title">
          Pronóstico meteorológico y de calidad del aire para el Estado de Puebla
        </h1>
        <p class="banner-subtitle">
          En esta página encontrarás datos sobre la calidad del aire y el pronóstico del clima obtenidos a través del modelo WRF.
        </p>
      </div>
    </section>

    <div class="row" style="margin: 50px" id="botones1">
      <div class="col-12 col-md-6 mb-4" id="meteo">
        <div class="card">
          <a href="#" class="card-link" onclick="activateMap('meteorologia'); return false;">
            <div class="card-img" style="background-image: url('./images/Tarjetas/tarjeta-calidad-aire.avif');">
              <div class="card-text">
                <h3>Meteorología</h3>
              </div>
            </div>
          </a>
        </div>
      </div>

      <div class="col-12 col-md-6 mb-4" id="cali">
        <div class="card">
          <a href="#" class="card-link" onclick="activateMap('calidad'); return false;">
            <div class="card-img" style="background-image: url('./images/Tarjetas/tarjeta-calidad-aire.avif');">
              <div class="card-text">
                <h3>Calidad del aire</h3>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>

    <div id="app" style="display: none;">
      <div id="side-menu" class="side-menu">
        <button class="back-btn" id="btn_back" title="Volver al inicio">
          <i class="fa-solid fa-arrow-left"></i>
        </button>
        <button class="menu-btn" id="btn_atmos" title="Atmósfera">
          <i class="fa-solid fa-temperature-half"></i> <span class="menu-label">Meteorología</span>
        </button>
        <button class="menu-btn" id="btn_aire" title="Calidad del aire">
          <i class="fa-solid fa-smog"></i> <span class="menu-label">Calidad del aire</span>
        </button>
        <button class="menu-btn" id="btn_hist" title="Historial">
          <i class="fa-solid fa-chart-line"></i> <span class="menu-label">Historial</span>
        </button>
      </div>

      <div id="main-content">
        <div id="map"></div>

        <!-- Barra superior dentro del mapa -->
        <div id="map-top-bar">
          <div id="municipio-map-control">
            <label for="hist-cabecera-map">Buscar municipio</label>
            <select id="hist-cabecera-map" class="form-control"></select>
          </div>
        </div>
        
        <div class="map-controls">
          <button class="control-btn" id="toggle-controls-btn" title="Control de Capas">
            <i class="fa-solid fa-layer-group"></i>
          </button>
          <button class="control-btn" id="zoom-in-btn" title="Acercar">
            <i class="fa-solid fa-plus"></i>
          </button>
          <button class="control-btn" id="zoom-out-btn" title="Alejar">
            <i class="fa-solid fa-minus"></i>
          </button>
          <button class="control-btn" id="reset-north-btn" title="Orientar al Norte">
            <i class="fa-solid fa-compass"></i>
          </button>
          <button class="control-btn" id="reset-position-btn" title="Posición Inicial">
            <i class="fa-solid fa-house"></i>
          </button>
        </div>

        <div class="weather-controls" id="weather-controls">
          <div class="controls-header">
            <h3>Control de Capas</h3>
            <button class="close-btn" id="close-controls-btn" title="Cerrar panel">&times;</button>
          </div>
          <div class="controls-body">
            <div class="control-group">
              <label for="select_run">Fecha del Pronóstico</label>
              <select id="select_run">
                <option value="2025-08-20">20 Agosto 2025</option>
                <option value="2025-08-21">21 Agosto 2025</option>
                <option value="2025-08-22" selected>22 Agosto 2025</option>
              </select>
            </div>
            <div class="control-group">
              <label for="selectHora">Pronósticos a</label>
              <select id="selectHora">
                <option value="12">12 horas</option>
                <option value="24" selected>24 horas</option>
                <option value="48">48 horas</option>
                <option value="72">72 horas</option>
              </select>
            </div>
            <!--voy a configurar esto para que tambien funcione como los botones
            <div class="control-group">
              <label for="select_dat">Parámetro</label>
              <select id="select_dat">
                <option value="meteorologia">Meteorología</option>
                <option value="calidad">Calidad del aire</option>
              </select>
            </div>-->
            <label for="select_var" style="font-weight: 500;">Sub-parámetro</label>
              <!--siento que esta parte no es necesarioa porque ya esxisten los botones
            <div class="control-group">
              <label for="select_var">Sub-parámetro</label>
              <select id="select_var">
                <option value="temperature">Temperatura</option>
                <option value="humidity">Humedad</option>
                <option value="precipitation">Precipitación</option>
                <option value="wind">Viento</option>
              </select>
            </div>-->
            <div class="layer-buttons" id="layer-buttons-meteo">
              <!--meteorologia-->
              <button class="layer-btn" data-layer="temperature"><i class="fa-solid fa-temperature-half"></i> Temperatura</button>
              <button class="layer-btn" data-layer="humidity"><i class="fa-solid fa-droplet"></i> Humedad</button>
              <button class="layer-btn" data-layer="precipitation"><i class="fa-solid fa-cloud-showers-heavy"></i> Precipitación</button>
              <button class="layer-btn" data-layer="wind"><i class="fa-solid fa-wind"></i> Viento</button>
              <button class="layer-btn" data-layer="pressure"><i class="fa-solid fa-gauge-high"></i> Presión</button>
              <button class="layer-btn" data-layer="radiation"><i class="fa-solid fa-sun"></i> Radiación</button>
            </div>
            <div class="layer-buttons" id="layer-buttons-aire" style="display: none;">
              <!--calidad del aire-->
              <button class="layer-btn" data-layer="co"><i class="fa-solid fa-smog"></i> CO</button>
              <button class="layer-btn" data-layer="no2"><i class="fa-solid fa-smog"></i> NO₂</button>
              <button class="layer-btn" data-layer="o3"><i class="fa-solid fa-smog"></i> O₃</button>
              <button class="layer-btn" data-layer="pm25"><i class="fa-solid fa-smog"></i> PM2.5</button>
            </div>
            <div class="animation-controls">
              <button class="play-btn" id="playBtn"><i class="fa-solid fa-play" id="playIcon"></i></button>
              <div class="speed-slider">
                <label for="speedSlider" style="font-size: 12px; color: #666;">Velocidad</label>
                <input type="range" min="100" max="2000" value="1000" id="speedSlider">
              </div>
            </div>
            <div class="controls-footer">
              <button class="footer-btn" id="btn_glosario">
                <i class="fa-solid fa-book"></i> Glosario
              </button>
              <button class="footer-btn" id="btn_datos">
                <i class="fa-solid fa-download"></i> Datos
              </button>
              <button class="footer-btn" id="btn_recarga">
                <i class="fa-solid fa-reload"></i> Recargar
              </button>
            </div>
          </div>
        </div>
        
        <div class="data-panel" id="dataPanel">
          <h4>Datos Actuales (Puebla, Puebla)</h4>
          <div class="data-value"><span class="data-label">Temperatura</span><span class="data-number" id="tempValue">--°C</span></div>
          <div class="data-value"><span class="data-label">Humedad</span><span class="data-number" id="humidityValue">--%</span></div>
          <div class="data-value"><span class="data-label">Viento</span><span class="data-number" id="windValue">-- km/h</span></div>
          <div class="data-value"><span class="data-label">Presión</span><span class="data-number" id="pressureValue">-- hPa</span></div>
        </div>
        
        <div class="legend" id="legend" style="display: none;">
          <div class="legend-title">Escala</div>
          <div class="legend-gradient" id="legend-gradient">
            <div class="filter-indicator" id="filter-indicator"></div>
          </div>
          <div class="legend-labels"></div>
          <div style="text-align: center; margin-top: 8px; font-size: 11px; color: #666;">
            Haz clic en la escala para filtrar
          </div>
        </div>
      </div>

      <div id="historial-dashboard" style="display: none;">
        <div class="dashboard-header">
            <div class="location-selector">
            <label for="hist-cabecera-select">Seleccione un municipio</label>
            <select id="hist-cabecera-select" class="form-control">
                </select>
            </div>
            <div class="data-type-selector">
            <label for="hist-tipo-select">Tipo de Datos</label>
            <select id="hist-tipo-select" class="form-control">
                <option value="meteo">Datos Meteorológicos</option>
                <option value="chem">Calidad del Aire</option>
            </select>
            </div>
        </div>

        <div class="dashboard-content">
            <div class="variables-grid" id="variable-toggles">
            </div>

            <div class="content-wrapper">
            <div id="hist-content">
                <div class="visualization-container">
                <div id="chartsHost"></div>
                </div>
                <div class="stats-container">
                <h4>Resumen Estadístico</h4>
                <div class="stats-table-wrapper">
                    <table class="stats-table">
                    <thead>
                        <tr>
                        <th>Variable</th>
                        <th>Promedio</th>
                        <th>Máximo</th>
                        <th>Mínimo</th>
                        <th>Unidades</th>
                        </tr>
                    </thead>
                    <tbody id="histStatsTable">
                        </tbody>
                    </table>
                </div>
                </div>
            </div>
            </div>
        </div>
        </div>

    
    <div class="municipality-modal" id="municipalityModal">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h2 class="modal-title" id="modalTitle">Ciudad de Rafael Lara</h2>
            <button class="download-btn" id="downloadCsvBtn">
              <i class="fa-solid fa-download"></i> Descargar (.CSV)
            </button>
          </div>
          <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-body">
          <h4>Resumen de Promedios</h4>
          <div class="pollutant-summary" id="pollutantSummary"></div>
            <div id="modalChartsHost" class="chart-cards-group" style="width:100%; display:flex; flex-wrap:wrap; gap:24px; margin-top:18px;"></div>
        </div>
      </div>
    </div>


    <div class="municipality-modal" id="glossaryModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Glosario de Términos</h2>
          <button class="modal-close" id="glossaryClose">&times;</button>
        </div>
        
        <div class="modal-body">
          <div style="max-height: 400px; overflow-y: auto;">
            <h4>Parámetros Meteorológicos</h4>
            <p><strong>Temperatura:</strong> Medida del grado de calor en la atmósfera, expresada en grados Celsius (°C).</p>
            <p><strong>Humedad:</strong> Cantidad de vapor de agua presente en el aire, expresada como porcentaje (%).</p>
            <p><strong>Precipitación:</strong> Cantidad de agua caída en forma de lluvia, nieve o granizo, medida en milímetros (mm).</p>
            <p><strong>Viento:</strong> Movimiento del aire en la atmósfera, medido en kilómetros por hora (km/h).</p>
            <p><strong>Presión:</strong> Fuerza ejercida por el aire sobre la superficie terrestre, medida en hectopascales (hPa).</p>
            
            <h4>Contaminantes del Aire</h4>
            <p><strong>CO (Monóxido de Carbono):</strong> Gas incoloro e inodoro producido por la combustión incompleta, medido en partes por millón (ppm).</p>
            <p><strong>NO₂ (Dióxido de Nitrógeno):</strong> Gas rojizo con olor acre, principalmente de vehículos, medido en partes por billón (ppb).</p>
            <p><strong>O₃ (Ozono):</strong> Gas formado por reacciones fotoquímicas en la atmósfera, medido en partes por billón (ppb).</p>
            <p><strong>PM2.5:</strong> Partículas finas menores a 2.5 micrómetros, medidas en microgramos por metro cúbico (μg/m³).</p>
          </div>
        </div>
      </div>
    </div>

    <script src="app.js" defer></script>
    <canvas id="filter-canvas" style="display: none"></canvas>
  </body>

</html>